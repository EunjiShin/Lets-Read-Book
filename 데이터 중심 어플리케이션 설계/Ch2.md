# Ch2. 데이터 모델과 질의 언어

> 💡 데이터 모델은 해결하려는 문제를 어떻게 생각해야 하는지에 대해서도 영향을 미치기에 중요하다. <br>
> 데이터 모델에 따라 SW가 할 수 있는 일과 할 수 없는 일이 크게 갈린다는 점을 기억하자.


## 관계형 모델과 문서 모델

| RDB, SQL | NoSQL |
| --- | --- |
| 데이터를 관계로 표현 (정규화된 구조) | RDB 스키마보다 동적이고 표현력이 풍부한 데이터 모델 |
| 트랜잭션 처리, 일괄 처리 등 비즈니스 데이터 처리에 적합 | 대규모 데이터셋, 높은 쓰기 처리량 등 RDB보다 높은 확장성 |

### 객체 관계형 불일치

- 임피던스 불일치 : 데이터를 관계형 테이블에 저장하기 위해 애플리케이션 코드 ↔ DB 모델 객체 사이 전환 계층이 필요한 이슈 (= 각 계층이 분리됨)
    - ex. 링크드인 프로필 기능
        - 전통적 SQL : 프로필 전체를 고유 식별자로 식별하고, 기타 개인 정보도 개별 테이블에 넣는 방식
        - JSON 모델 : 개인정보를 JSON으로 부호화해 통째로 저장하는 방식. 지역성이 좋아짐
            - SQL과 다르게 join할 필요 없이, 한 문서만 바라보면 되므로!

### 다대일과 다대다

- 중복된 데이터를 가져갈 필요가 없기에 (쓰기 오버헤드, 갱신 손실-값 불일치 등의 문제 야기 가능) 정규화를 수행한다.
- 문서 모델에서는 다대일/다대다가 적합하지 않다. 관계형에선 조인을 이용해 쉽게 다른 테이블을 참조할 수 있다.

### 문서 데이터베이스

- 네트워크 모델 (코다실 모델)
    - 레코드는 다중 부모를 가질 수 있다.
    - 최상위 레코드부터 연속된 연결 경로(접근 경로)를 따라 레코드에 접근한다 (a.k.a 포인터)
    - 따라서 다양한 관계를 모두 추적해야 하므로 순회 성능 저하, CUD 성능 저하 등의 이슈가 존재한다.
- 관계형 모델 (→ SQL로 발전)
    - 알려진 모든 데이터를 배치하여 튜플의 컬렉션으로 만든다. 즉, 복잡한 접근 경로가 없다.
        - 질의 최적화기(query optimizer)가 자동으로 접근 경로를 만들어줌!
        - 한번 잘 만들어두면 모든 개발자가 범용적으로 사용할 수 있다.
    - 원하는 로우를 선택해서 읽고, 새로운 로우를 자유롭게 추가 수정 삭제할 수 있다.
    - 외래키를 이용해 다대일 또는 다대다를 표현한다. (문서형 모델에서는 문서 참조)

### 관계형 데이터베이스와 오늘날의 문서 데이터베이스

- 문서 데이터 모델 vs 관계형 데이터 모델
    - 문서 데이터 모델을 선호하는 이유
        - 스키마 유연성, 지역성에 기인한 더 나은 성능, 다양한 데이터 구조
    - 관계형 모델을 선호하는 이유
        - 조인, 다대일 / 다대다 관계에 대한 지원
- 질의를 위한 데이터 지역성
    - 문서 데이터 모델을 사용할 경우, 특정 문서의 많은 부분이 필요할 때 저장소 지역성을 활용해 성능 이점을 볼 수 있다.
    - 관계형 모델에서는 다중 테이블 색인 클러스터 테이블, 칼럼 패밀리 등의 방법을 이용해 구현할 수 있다.
- 관계형 데이터베이스와 문서 데이터베이스는 시간이 지날수록 부족한 부분을 보완하면서 비슷해지고 있다.

> ❄️ **문서 데이터베이스는 스키마리스(schemaless)일까?** <br>
> : 암묵적인 스키마가 존재하지만 데이터베이스가 강요하지는 않는 형태 <br>
> : 즉 쓰기 스키마는 없고, 읽기 스키마는 있다고 보는 것이 더 적합하다. <br>
> : 애플리케이션 요구사항과 데이터 형태(구조)를 고려하여 스키마 필요 여부를 정해야 한다.


---

## 데이터를 위한 질의 언어

- 명령형 코드
    - 특정 순서로 특정 연산을 수행하게끔 컴퓨터에 지시한다.
- 선언형 질의 (ex. SQL)
    - 결과가 충족해야 하는 조건과 데이터를 변환하는 방법을 텀퓨터에 지시한다.
    - 특정 순서를 보장하지 않으므로 순서가 바뀌어도 되며, 따라서 병렬 실행에 적합하다.
    - 기능 제한적인 만큼 자동으로 최적화할 수 있는 여지가 많다.
- 맵 리듀스 질의
    - 많은 컴퓨터에서 대량의 데이터를 처리하기 위한 프로그래밍 모델
    - 많은 문서 대상의 read-only 질의를 수행할 때 사용된다.
        - 선언형도 명령형도 아닌 그 중간즈음의 질의.
    - mongoDB에서의 맵 리듀스는 순수 함수를 사용해야 한다는 제약이 있다. 최신 버전에선 집계 파이프라인을 이용해 맵 리듀스와 동일한 기능을 더 쉽게 구현할 수 있다.

---

## 그래프형 데이터 모델

> 💡 정점(vertex), 간선(edge) 두 객체로 이루어지는 그래프 구조를 이용한 데이터 모델


### 속성 그래프

- 구성 요소
    - `정점`
        - 고유한 식별자
        - 유출(outgoing) 간선 집합
        - 유입(incoming) 간선 집합
        - 속성 컬렉션 (K-V)
    - `간선`
        - 고유한 식별자
        - 간선이 시작하는 정점 (꼬리 정점)
        - 간선이 끝나는 정점 (머리 정점)
        - 두 정점 간 관계 유형을 설명하는 레이블
        - 속성 컬렉션 (K-V)
- 데이터 모델링을 위한 많은 유연성을 제공하고, 따라서 발전성이 좋다.
    - 애플리케이션에 기능을 추가하는 경우, 데이터 구조 변경을 수용하게끔 쉽게 그래프를 확장할 수 있다.

### 사이퍼 질의 언어

- 속성 그래프를 위한 선언형 질의 언어
- 질의 최적화기가 가장 효율적이라고 예측한 전략을 자동으로 선택하므로, 수행에 대해 자세히 지정할 필요가 없다.

### SQL 그래프 질의

- 그래프 데이터를 관계형 구조로 넣어도 SQL을 사용해 질의할 수 있을까?
    - 예압. 재귀 공통 테이블 식(recursive common table expression = with recursive문)을 이용할 수 있다. 하지만 복잡도가 아주많이 높아짐!

### 트리플 저장소와 스파클

- 같은 생각을 다른 용어를 사용해 설명하는 모델. 속성 그래프 모델과 거의 동등하다.
- 모든 정보를 (주어, 서술어, 목적어) 라는 세 부분 구문으로 저장한다.
    - 주어 = 정점
    - 목적어 = 그래프의 다른 정점 혹은 원시 데이터 값
- 동일한 주어를 반복하는 작업을 간단하게 만든다.

### 데이터 로그

- 스파클이나 사이퍼보다 훨씬 오래된 언어
- 트리플 저장소 모델과 유사하지만 좀 더 일반화된 모델이다
    - 서술어(주어, 목적어)로 작성
    - 단계를 나눠 한번에 조금씩 질의한다는 차이가 있다.
- 다른 질의의 규칙을 결합하거나 재사용할 수 있기에 매우 강력한 접근 방식이다.
    - 사용하긴 어렵지만, 데이터가 복잡할 경우 효과적